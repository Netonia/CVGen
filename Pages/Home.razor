@page "/"
@using CVGen.Models
@using CVGen.Services

<PageTitle>CV Gen</PageTitle>

<div class="cv-generator-container">
    @* <h1 class="app-title">CV Gen</h1> *@
    
    <div class="cv-layout">
        <div class="form-section">
            <h2>Personal Information</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" class="form-control" @bind="cvData.PersonalInfo.Name" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" class="form-control" @bind="cvData.PersonalInfo.Email" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" class="form-control" @bind="cvData.PersonalInfo.Phone" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" class="form-control" @bind="cvData.PersonalInfo.Location" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>
            <div class="form-group">
                <label>LinkedIn</label>
                <input type="text" class="form-control" @bind="cvData.PersonalInfo.LinkedIn" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>
            <div class="form-group">
                <label>GitHub</label>
                <input type="text" class="form-control" @bind="cvData.PersonalInfo.GitHub" @bind:event="oninput" @bind:after="OnInputChanged" />
            </div>

            <h2>Professional Summary</h2>
            <div class="form-group">
                <textarea class="form-control" rows="4" @bind="cvData.Summary" @bind:event="oninput" @bind:after="OnInputChanged" placeholder="Brief summary of your professional background..."></textarea>
            </div>

            <h2>Work Experience</h2>
            @for (int i = 0; i < cvData.WorkExperience.Count; i++)
            {
                var index = i;
                <div class="item-container">
                    <div class="form-group">
                        <label>Position</label>
                        <input type="text" class="form-control" @bind="cvData.WorkExperience[index].Position" @bind:event="oninput" @bind:after="OnInputChanged" />
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" class="form-control" @bind="cvData.WorkExperience[index].Company" @bind:event="oninput" @bind:after="OnInputChanged" />
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="text" class="form-control" @bind="cvData.WorkExperience[index].StartDate" @bind:event="oninput" @bind:after="OnInputChanged" />
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="text" class="form-control" @bind="cvData.WorkExperience[index].EndDate" @bind:event="oninput" @bind:after="OnInputChanged" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" rows="3" @bind="cvData.WorkExperience[index].Description" @bind:event="oninput" @bind:after="OnInputChanged"></textarea>
                    </div>
                    <button class="btn btn-danger btn-sm" @onclick="() => RemoveWorkExperience(index)">Remove</button>
                </div>
            }
            <button class="btn btn-secondary mb-3" @onclick="AddWorkExperience">Add Work Experience</button>

            <h2>Education</h2>
            @for (int i = 0; i < cvData.Education.Count; i++)
            {
                var index = i;
                <div class="item-container">
                    <div class="form-group">
                        <label>Degree</label>
                        <input type="text" class="form-control" @bind="cvData.Education[index].Degree" @bind:event="oninput" @bind:after="OnInputChanged" />
                    </div>
                    <div class="form-group">
                        <label>Institution</label>
                        <input type="text" class="form-control" @bind="cvData.Education[index].Institution" @bind:event="oninput" @bind:after="OnInputChanged" />
                    </div>
                    <div class="form-group">
                        <label>Year</label>
                        <input type="text" class="form-control" @bind="cvData.Education[index].Year" @bind:event="oninput" @bind:after="OnInputChanged" />
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" rows="2" @bind="cvData.Education[index].Description" @bind:event="oninput" @bind:after="OnInputChanged"></textarea>
                    </div>
                    <button class="btn btn-danger btn-sm" @onclick="() => RemoveEducation(index)">Remove</button>
                </div>
            }
            <button class="btn btn-secondary mb-3" @onclick="AddEducation">Add Education</button>

            <h2>Skills</h2>
            <div class="skills-input">
                @for (int i = 0; i < cvData.Skills.Count; i++)
                {
                    var index = i;
                    <div class="skill-item">
                        <input type="text" class="form-control" @bind="cvData.Skills[index]" @bind:event="oninput" @bind:after="OnInputChanged" />
                        <button class="btn btn-danger btn-sm" @onclick="() => RemoveSkill(index)">×</button>
                    </div>
                }
                <button class="btn btn-secondary mb-3" @onclick="AddSkill">Add Skill</button>
            </div>

            <h2>Languages</h2>
            @for (int i = 0; i < cvData.Languages.Count; i++)
            {
                var index = i;
                <div class="item-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Language</label>
                            <input type="text" class="form-control" @bind="cvData.Languages[index].Name" @bind:event="oninput" @bind:after="OnInputChanged" />
                        </div>
                        <div class="form-group">
                            <label>Proficiency</label>
                            <input type="text" class="form-control" @bind="cvData.Languages[index].Proficiency" @bind:event="oninput" @bind:after="OnInputChanged" placeholder="e.g., Native, Fluent, Intermediate" />
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm" @onclick="() => RemoveLanguage(index)">Remove</button>
                </div>
            }
            <button class="btn btn-secondary mb-3" @onclick="AddLanguage">Add Language</button>
        </div>

        <div class="preview-section">
            <div class="preview-header">
                <h2>CV Gen</h2>
                <div class="export-buttons">
                    <button class="btn btn-primary" @onclick="DownloadPdf">Download PDF</button>
                    <button class="btn btn-outline-primary" @onclick="DownloadHtml">Export HTML</button>
                </div>
            </div>
            <div id="cv-preview" class="cv-preview">
                @((MarkupString)renderedCV)
            </div>
        </div>
    </div>
</div>
